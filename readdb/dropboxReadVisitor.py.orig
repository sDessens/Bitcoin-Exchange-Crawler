#-------------------------------------------------------------------------------
# Name          stub
# Purpose:      Module is stub implementation of ReadDB Visitor.
#               Developers can use this file as an example when implementing
#               additional information sources
#
# Author:       Stefan Dessens
#
# Created:      17-04-2014
# Copyright:    (c) Stefan Dessens 2014
# Licence:      TBD
#-------------------------------------------------------------------------------

import common.dropboxLib as db

def getInstance():
    return DropboxReadVisitor()

<<<<<<< Updated upstream
## this is a stub db reader. It provides an template that provides all
#  required functionality for an db reader
=======
##
# this is a DropboxReadVisitor. It provides a way to read a file from dropbox
>>>>>>> Stashed changes
class DropboxReadVisitor:
    def __init__(self):
        pass

    ## check if given object is accepted by visitor
    #  @return True if this visitor accepts the given object.
    def accept( self, obj ):
        try:
            return obj['type'] == 'dropbox'
        except Exception as e:
            return False

<<<<<<< Updated upstream
    ## parse and return data specified in obj.
    #  @return {'identifier' : BalanceData} map or exception.
=======
    ##parse and return data specified in obj.
    # @param obj a dict containing atleast: folder,sperator,app_key,app_secret and data with a list of ids
    # @return 'identifier' -> BalanceData map or exception.
>>>>>>> Stashed changes
    def visit(self, obj):
        storage = db.DropboxStorage( obj['folder'],obj['separator'], obj['app_key'], obj['app_secret'] )

        out = {}
        for id in obj['data']:
            try:
                out[id] = storage.readBalance(id)
            except Exception as e:
                print str(e)
        return out
